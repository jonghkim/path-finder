<!DOCTYPE html>
<html>
<head>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f5f5f5;
      text-align: center;
      color: #333;
    }
    
    .tabcontent {
      margin: 10px auto; /* added top margin */
      padding: 20px;
      width: 90%;
      max-width: 800px;
      background-color: #ffffff;
      border-radius: 5px;
      box-shadow: 0px 5px 15px rgba(0, 0, 0, 0.1);
    }

    .large-tabcontent {
      width: 90%; /* adjust this value to your preference */
      margin: 10px auto; /* added top margin */
      max-width: 1800px;
    }

    .tabcontent h2, .tabcontent h3 {
      margin-bottom: 20px;
      color: #2c3e50;
    }

    .tabcontent h3 {
      border-top: 1px dotted #333;
      padding-top: 20px;
    }

    .tabcontent label {
      display: block;
      margin-top: 20px;
      margin-bottom: 5px;
      font-weight: bold;
      color: #2c3e50;
    }

    .tabcontent textarea {
      width: 100%;
      height: 150px;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 5px;
      resize: vertical;
      font-size: 16px;
      box-sizing: border-box;
    }

    .tabcontent textarea.small-textarea {
      width: 100%;
      height: 300px;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 5px;
      resize: vertical;
      font-size: 16px;
      box-sizing: border-box;
    }

    .tabcontent textarea.large-textarea {
      width: 100%;
      height: 650px;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 5px;
      resize: vertical;
      font-size: 16px;
      box-sizing: border-box;
    }

    .tabcontent textarea:focus {
      outline: none;
      border-color: #3498db;
      box-shadow: 0 0 5px rgba(52, 152, 219, 0.5);      
    }

    .pane-container {
      display: flex;
      flex-direction: row;
      justify-content: space-between;
    }

    .pane-container .left-pane, .pane-container .right-pane {
      width: 49.5%;
    }    
  </style>

  <script src="questions_20230716.js"></script>
  
</head>

<body>
  <h1>Find Your Path</h1>

  <!-- Tabs -->
  <div id="tabs">
    <button class="tablink" onclick="openTab(event, 'vision')">Vision</button>
    <button class="tablink" onclick="openTab(event, 'yearlyGoal')">Yearly Goal</button>
    <button class="tablink" onclick="openTab(event, 'monthlyGoal')">Monthly Goal</button>
    <button class="tablink" onclick="openTab(event, 'weeklyGoal')">Weekly Goal</button>
    <button class="tablink" onclick="openTab(event, 'dailyGoal')">Daily Goal</button>
    <button class="tablink" onclick="openTab(event, 'achievement')">Achievements & Reflection</button>
    <button class="tablink" onclick="openTab(event, 'question')">Question</button>
    <button class="tablink" onclick="openTab(event, 'about')">About</button>
  </div>

  <!-- Content -->

  <div class="tabcontent" id="vision">
    <h2>Vision</h2>
    <textarea id="visionInput" class="small-textarea" oninput="saveGoal('visionInput');" placeholder="Write your vision here"></textarea>
      
    <h3>Bringing Your Year Into Focus</h3>
    <label for="yearImprovement">How will you improve yourself this year?</label>
    <textarea id="yearImprovement" class="small-textarea" oninput="saveGoal('yearImprovement');" placeholder="Your improvement goal"></textarea>
  
    <label for="perfectYear">What would it look like if this year went perfectly?</label>
    <textarea id="perfectYear" class="small-textarea" oninput="saveGoal('perfectYear');" placeholder="Your perfect year"></textarea>
  
    <label for="startDoing">What do you want to start doing this year?</label>
    <textarea id="startDoing" class="small-textarea" oninput="saveGoal('startDoing');" placeholder="Start doing..."></textarea>
  
    <label for="actions">What are your key actions and milestones for achieving your vision?</label>
    <textarea id="actions" class="small-textarea" oninput="saveGoal('actions');" placeholder="Key actions and milestones"></textarea>
  </div>
  
  <div class="tabcontent" id="yearlyGoal">
    <h2>Yearly Goal</h2>
    <div class="yearlygoal">
      <textarea id="yearlyGoalInput" class="large-textarea" oninput="saveGoal('yearlyGoalInput'); updateMonthlyGoal()"></textarea>
    </div>
  </div>

  <div class="tabcontent large-tabcontent" id="monthlyGoal">
    <div class="pane-container">
      <div class="left-pane">
        <h2>Yearly Goal</h2>
        <textarea id="monthlyYearlyGoalInput" class="large-textarea" disabled></textarea>
      </div>
      <div class="right-pane">
        <h2>Monthly Goal</h2>
        <textarea id="monthlyGoalInput" class="large-textarea" oninput="saveGoal('monthlyGoalInput'); updateWeeklyGoal()"></textarea>
      </div>
    </div>
  </div>

  <div class="tabcontent large-tabcontent" id="weeklyGoal">
    <div class="pane-container">
      <div class="left-pane">
        <h2>Monthly Goal</h2>
        <textarea id="weeklyMonthlyGoalInput" class="large-textarea" disabled></textarea>
      </div>
      <div class="right-pane">
        <h2>Weekly Goal</h2>
        <textarea id="weeklyGoalInput" class="large-textarea" oninput="saveGoal('weeklyGoalInput'); updateDailyGoal()"></textarea>
      </div>
    </div>
</div>

<div class="tabcontent large-tabcontent" id="dailyGoal">
  <div class="pane-container">
  <div class="left-pane">
    <h2>Weekly Goal</h2>
    <textarea id="dailyWeeklyGoalInput" class="large-textarea" disabled></textarea>
  </div>
  <div class="right-pane">
    <h2>Daily Goal</h2>
    <textarea id="dailyGoalInput" class="large-textarea" oninput="saveGoal('dailyGoalInput')"></textarea>
  </div>
  </div>
</div>

<div class="tabcontent large-tabcontent" id="achievement">
  <div class="pane-container">
  <div class="left-pane">
    <h2>Yearly Goal</h2>
    <textarea id="achievementYearlyGoalInput" class="large-textarea" disabled></textarea> <!-- Fix here: change the id to "achievementYearlyGoalInput" -->
  </div>
  <div class="right-pane">
    <h2>Achievements & Reflection</h2>
    <textarea id="achievementInput" class="large-textarea" oninput="saveGoal('achievementInput');"></textarea>
  </div>    
  </div>
</div>  

  <div class="tabcontent" id="question">
    <h2>Question</h2>
    <button onclick="generateRandomQuestion()">Generate Question</button>
    <p id="questionDisplay"></p>
    <textarea class="small-textarea"></textarea>
  </div>

  <div class="tabcontent" id="about">
    <h2>About</h2>
    <p>Welcome to our text-based scheduler, a tool designed to provide flexibility in planning your goals.</p>
    <p>Personally, I use it to update my daily goals every morning. These aren't just simple to-do lists, they're steps towards achieving higher, more substantial goals.</p>
    <p>Please note, each page is designed to reset at the start of its corresponding time period. For example, the daily goal page resets every day at 12am, while the weekly goal page resets every Monday.</p>
    <p>Feel free to use this tool however you like, and please let me know if you have any suggestions for improvement!</p>
  </div>

  <script src="https://www.gstatic.com/firebasejs/8.2.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.2.1/firebase-firestore.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyDGGHtfrqX6fEDFPZnvhWO1NQFNjL0P0Y8",
      authDomain: "pathfinder-fd96a.firebaseapp.com",
      projectId: "pathfinder-fd96a",
      storageBucket: "pathfinder-fd96a.appspot.com",
      messagingSenderId: "801645100816",
      appId: "1:801645100816:web:e9118c18d09a3fc79b2f95",
      measurementId: "G-DPJQ376Q6J"
    }; 

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const queryString = window.location.search;
    const urlParams = new URLSearchParams(queryString);
    const username = urlParams.get('username');

    // Hide other tabs and load saved goals
    const tabContents = document.querySelectorAll('.tabcontent');

    tabContents.forEach(content => {
      if (content.id !== 'yearlyGoal') {
        content.style.display = 'none';
      }
    });

    window.addEventListener('DOMContentLoaded', () => {
      loadGoal('visionInput');
      loadGoal('yearImprovement');
      loadGoal('perfectYear');
      loadGoal('startDoing');
      loadGoal('actions');
      loadGoal('yearlyGoalInput');
      loadGoal('monthlyYearlyGoalInput');
      loadGoal('monthlyGoalInput');
      loadGoal('weeklyMonthlyGoalInput');
      loadGoal('weeklyGoalInput');
      loadGoal('dailyWeeklyGoalInput');
      loadGoal('dailyGoalInput');
      loadGoal('achievementInput');
      loadGoal('achievementYearlyGoalInput');
      updateMonthlyGoal();
      updateWeeklyGoal();
      updateDailyGoal();
      updateAchievement();
    });

    function saveGoal(inputId) {
      const input = document.getElementById(inputId);

      let today = new Date();
      let year = today.getFullYear(); // Get the year
      let month = String(today.getMonth() + 1).padStart(2, '0'); // Get the month and pad it with 0 if necessary
      let date = String(today.getDate()).padStart(2, '0'); // Get the day and pad it with 0 if necessary
      let week = getWeekNumber(today); // Get the week number

      let documentName;

      // Determine the document name based on the inputId
      if (inputId === 'yearlyGoalInput') {
        documentName = 'year-' + year;
      } else if (inputId === 'achievementInput') {
        documentName = year+'-achievement';
      } else if (inputId === 'monthlyGoalInput') {
        documentName = 'month-' + year + '-' + month;
      } else if (inputId === 'weeklyGoalInput') {
        documentName = 'week-' + year + '-W' + week;
      } else if (inputId === 'dailyGoalInput') {
        documentName = 'day-' + year + '-' + month + '-' + date;
      } else {
        documentName = inputId; // Default to the inputId for other inputs
      }

      // Save the goal to Firebase Firestore
      db.collection("users").doc(username).collection("goals").doc(documentName).set({
        value: input.value
      })
      .then(() => {
        console.log("Goal saved to Firestore");
      })
      .catch((error) => {
        console.error("Error saving goal to Firestore: ", error);
      });
    }

    function loadGoal(inputId) {
      const input = document.getElementById(inputId);

      let today = new Date();
      let year = today.getFullYear(); // Get the year
      let month = String(today.getMonth() + 1).padStart(2, '0'); // Get the month and pad it with 0 if necessary
      let date = String(today.getDate()).padStart(2, '0'); // Get the day and pad it with 0 if necessary
      let week = getWeekNumber(today); // Get the week number

      let documentName;

      // Determine the document name based on the inputId
      if (inputId === 'yearlyGoalInput') {
        documentName = 'year-' + year;
      } else if (inputId === 'achievementInput') {
        documentName = year+'-achievement';
      } else if (inputId === 'monthlyGoalInput') {
        documentName = 'month-' + year + '-' + month;
      } else if (inputId === 'weeklyGoalInput') {
        documentName = 'week-' + year + '-W' + week;
      } else if (inputId === 'dailyGoalInput') {
        documentName = 'day-' + year + '-' + month + '-' + date;
      } else {
        documentName = inputId; // Default to the inputId for other inputs
      }

      // Load the goal from Firebase Firestore
      db.collection("users").doc(username).collection("goals").doc(documentName).get()
      .then((doc) => {
        if (doc.exists) {
          const goal = doc.data().value;
          input.value = goal;
        }
      })
      .catch((error) => {
        console.error("Error loading goal from Firestore: ", error);
      });
    }

    // Get the week number
    function getWeekNumber(d) {
      d = new Date(Date.UTC(d.getFullYear(), d.getMonth(), d.getDate()));
      d.setUTCDate(d.getUTCDate() + 4 - (d.getUTCDay() || 7));
      let yearStart = new Date(Date.UTC(d.getUTCFullYear(), 0, 1));
      let weekNo = Math.ceil((((d - yearStart) / 86400000) + 1) / 7);
      return weekNo;
    }

    function openTab(evt, tabName) {
      // Hide all tab contents
      tabContents.forEach(content => {
        content.style.display = 'none';
      });

      // Show the selected tab content
      const selectedTabContent = document.getElementById(tabName);
      if (selectedTabContent) {
        selectedTabContent.style.display = 'block';
        
        // Update the left pane with the previous goal value
        const leftPaneInputId = tabName === 'monthlyGoal' ? 'monthlyYearlyGoalInput' :
                                tabName === 'weeklyGoal' ? 'weeklyMonthlyGoalInput' :
                                tabName === 'dailyGoal' ? 'dailyWeeklyGoalInput' : 
                                tabName === 'achievement' ? 'achievementYearlyGoalInput' : '';
        if (leftPaneInputId) {
          const leftPaneInput = document.getElementById(leftPaneInputId);
          const previousGoalInputId = tabName === 'monthlyGoal' ? 'yearlyGoalInput' :
                                      tabName === 'weeklyGoal' ? 'monthlyGoalInput' :
                                      tabName === 'dailyGoal' ? 'weeklyGoalInput' : 
                                      tabName === 'achievement' ? 'yearlyGoalInput' : '';
          if (previousGoalInputId) {
            const previousGoalInput = document.getElementById(previousGoalInputId);
            leftPaneInput.value = previousGoalInput.value;
          }
        }
      }
    }

    function updateMonthlyGoal() {
      const yearlyGoalInput = document.getElementById('yearlyGoalInput');
      const monthlyYearlyGoalInput = document.getElementById('monthlyYearlyGoalInput');
      monthlyYearlyGoalInput.value = yearlyGoalInput.value;
    }

    function updateWeeklyGoal() {
      const monthlyGoalInput = document.getElementById('monthlyGoalInput');
      const weeklyMonthlyGoalInput = document.getElementById('weeklyMonthlyGoalInput');
      weeklyMonthlyGoalInput.value = monthlyGoalInput.value;
    }

    function updateDailyGoal() {
      const weeklyGoalInput = document.getElementById('weeklyGoalInput');
      const dailyWeeklyGoalInput = document.getElementById('dailyWeeklyGoalInput');
      dailyWeeklyGoalInput.value = weeklyGoalInput.value;
    }

    function updateAchievement() {
      const yearlyGoalInput = document.getElementById('yearlyGoalInput');
      const achievementYearlyGoalInput = document.getElementById('achievementYearlyGoalInput');
      achievementYearlyGoalInput.value = yearlyGoalInput.value;
    }

    // Function to generate a random question
    // function generateRandomQuestion() {
    //   const questionDisplay = document.getElementById('questionDisplay');
    //   const randomIndex = Math.floor(Math.random() * questions.length);
    //   const randomQuestion = questions[randomIndex];
    //   questionDisplay.textContent = randomQuestion;
    // }
    function generateRandomQuestion() {
      const questionDisplay = document.getElementById('questionDisplay');
      const randomIndex = Math.floor(Math.random() * questions.length);
      const randomQuestion = questions[randomIndex];
      questionDisplay.innerHTML = randomQuestion;
    }    
  </script>
</body>
</html>