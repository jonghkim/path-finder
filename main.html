<!DOCTYPE html>
<html>
<head>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f5f5f5;
      text-align: center;
      color: #333;
    }
    
    .tabcontent {
      margin: 10px auto; /* added top margin */
      padding: 20px;
      width: 90%;
      max-width: 800px;
      background-color: #ffffff;
      border-radius: 5px;
      box-shadow: 0px 5px 15px rgba(0, 0, 0, 0.1);
    }

    .large-tabcontent {
      width: 90%; /* adjust this value to your preference */
      margin: 10px auto; /* added top margin */
      max-width: 1800px;
    }

    .tabcontent h2, .tabcontent h3 {
      margin-bottom: 20px;
      color: #2c3e50;
    }

    #vision h3 {
      border-top: 1px dotted #333;
      padding-top: 20px;
    }

    .tabcontent label {
      display: block;
      margin-top: 20px;
      margin-bottom: 5px;
      font-weight: bold;
      color: #2c3e50;
    }

    .tabcontent textarea {
      width: 100%;
      height: 150px;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 5px;
      resize: vertical;
      font-size: 16px;
      box-sizing: border-box;
    }

    .tabcontent textarea.small-textarea {
      width: 100%;
      height: 250px;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 5px;
      resize: vertical;
      font-size: 16px;
      box-sizing: border-box;
    }

    .tabcontent textarea.small-small-textarea {
      width: 100%;
      height: 150px;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 5px;
      resize: vertical;
      font-size: 16px;
      box-sizing: border-box;      
    }

    .tabcontent textarea.large-textarea {
      width: 100%;
      height: 560px;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 5px;
      resize: vertical;
      font-size: 16px;
      box-sizing: border-box;
    }

    .tabcontent textarea:focus {
      outline: none;
      border-color: #3498db;
      box-shadow: 0 0 5px rgba(52, 152, 219, 0.5);      
    }

    .pane-container {
      display: flex;
      flex-direction: row;
      justify-content: space-between;
    }

    .pane-container .left-pane, .pane-container .right-pane {
      width: 49.5%;
    }    
    
    .vertical-pane-container {
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    .vertical-pane-container .top-pane,
    .vertical-pane-container .bottom-pane {
      width: 99%;
      flex: 1;
    }

    .date-selection {
      margin-top: 10px;
    }

    .date-selection label {
      margin-right: 10px;
    }    

    /* Horizontal split for Action Plans section */
    .action-plans-container {
      display: flex;
      gap: 20px;
    }

    .action-plans-container .action-plans {
      flex: 1;
    }

    .action-plans-container .progress {
      flex: 1;
    }  

    .spacer {
      display: block;
      height: 39px;  /* Adjust this value to create the space you need */
    }
  </style>

  <script src="questions_20230716.js"></script>
  
</head>

<body>
  <h1>Find Your Path</h1>

  <!-- Tabs -->
  <div id="tabs">
    <button class="tablink" onclick="openTab(event, 'vision')">Vision</button>
    <button class="tablink" onclick="openTab(event, 'yearlyGoal')">Yearly Goal</button>
    <button class="tablink" onclick="openTab(event, 'monthlyGoal')">Monthly Goal</button>
    <button class="tablink" onclick="openTab(event, 'weeklyGoal')">Weekly Goal</button>
    <button class="tablink" onclick="openTab(event, 'dailyGoal')">Daily To Do</button>
    <button class="tablink" onclick="openTab(event, 'achievement')">Achievements & Reflection</button>
    <button class="tablink" onclick="openTab(event, 'question')">Question</button>
    <button class="tablink" onclick="openTab(event, 'about')">About</button>
  </div>

  <!-- Date selection -->
  <div class="date-selection">
    <input type="date" id="datePicker" onchange="updateSelectedDate()">
  </div>
  <!-- Content -->

  <div class="tabcontent" id="vision">
    <h2>Vision</h2>
    <textarea id="visionInput" class="large-textarea" oninput="saveGoal('visionInput', selectedDate);" placeholder="Write your vision here"></textarea>
  
  </div>
  
  <!-- <div class="tabcontent" id="yearlyGoal">
    <h2>Yearly Goal</h2>
    <div class="yearlygoal">
      <textarea id="yearlyGoalInput" class="large-textarea" oninput="saveGoal('yearlyGoalInput', selectedDate); updateMonthlyGoal(selectedDate);"></textarea>
    </div>
  </div> -->

  <div class="tabcontent tabcontent" id="yearlyGoal">
    <h2>My Goals</h2>
    <textarea id="yearlyMilestonesInput" class="small-textarea" oninput="saveGoal('yearlyMilestonesInput', selectedDate);"></textarea>

    <h2>What are the key actions?</h2>
    <textarea id="yearlyActionPlansInput" class="large-textarea" oninput="saveGoal('yearlyActionPlansInput', selectedDate);" placeholder="Key actions"></textarea>

    <h2>Bringing Your Year Into Focus</h2>
    <label for="yearlyImprovement">How will you improve yourself this year?</label>
    <textarea id="yearlyImprovement" class="small-textarea" oninput="saveGoal('yearlyImprovement', selectedDate);" placeholder="Your improvement goal"></textarea>
  
    <label for="yearlyPerfectYear">What would it look like if this year went perfectly?</label>
    <textarea id="yearlyPerfectYear" class="small-textarea" oninput="saveGoal('yearlyPerfectYear', selectedDate);" placeholder="Your perfect year"></textarea>
  
    <label for="yearlyStartDoing">What do you want to start doing?</label>
    <textarea id="yearlyStartDoing" class="small-textarea" oninput="saveGoal('yearlyStartDoing', selectedDate);" placeholder="Start doing"></textarea>
  
    <label for="yearlyStopDoing">What do you want to stop doing?</label>
    <textarea id="yearlyStopDoing" class="small-textarea" oninput="saveGoal('yearlyStopDoing', selectedDate);" placeholder="Stop doing"></textarea>
      
  </div>

  <div class="tabcontent large-tabcontent" id="monthlyGoal">
    <div class="monthlyGoal">
        <div class="pane-container">
            <div class="left-pane">
                <h2>Monthly Milestones</h2>
                <label for="monthlyMilestonesInput">What do you want to achieve this month and how does it contributes to your higher goal?</label>
                <textarea id="monthlyMilestonesInput" class="large-textarea" oninput="saveGoal('monthlyMilestonesInput', selectedDate);"></textarea>
            </div>
            <div class="right-pane">
                <h2>Monthly Action Plans</h2>
                <label for="monthlyMilestonesInput">What are the key actions to achieve those goals?</label>
                <textarea id="monthlyActionPlansInput" class="large-textarea" oninput="saveGoal('monthlyActionPlansInput', selectedDate);"></textarea>
            </div>
        </div>
    </div>
  </div>

  <div class="tabcontent large-tabcontent" id="weeklyGoal">
      <div class="weeklyGoal">
          <div class="pane-container">
              <div class="left-pane">
                  <h2>Weekly Goals</h2>
                  <label for="weeklyMilestonesInput">What is your focus this week?</label>
                  <textarea id="weeklyMilestonesInput" class="large-textarea" oninput="saveGoal('weeklyMilestonesInput', selectedDate);"></textarea>
              </div>
              <div class="right-pane">
                  <h2>Action Plans</h2>
                  <label for="weeklyActionPlansInput">What are the key actions?</label>
                  <textarea id="weeklyActionPlansInput" class="large-textarea" oninput="saveGoal('weeklyActionPlansInput', selectedDate);"></textarea>
            </div>
          </div>
      </div>
  </div>
  
  <div class="tabcontent tabcontent" id="dailyGoal">
      <div class="dailyGoal">
          <div class="vertical-pane-container">
            <div class="top-pane">
              <h2>Daily Goal</h2>
              <label for="dailyMilestonesInput">What is your focus today?</label>
              <textarea id="dailyMilestonesInput" class="small-small-textarea" oninput="saveGoal('dailyMilestonesInput', selectedDate);"></textarea>
            </div>
            <div class="bottom-pane">
              <h2>Tasks</h2>
              <label for="dailyActionPlansInput">What are the important tasks?</label>
              <textarea id="dailyActionPlansInput" class="small-textarea" oninput="saveGoal('dailyActionPlansInput', selectedDate);"></textarea>
            </div>
          </div>    
      </div>      
  </div>
  
  <div class="tabcontent large-tabcontent" id="achievement">
    <div class="pane-container">
      <div class="left-pane">
        <div class="vertical-pane-container">
          <div class="top-pane">
            <h2>Yearly Milestones</h2>
            <textarea id="achievementYearlyMilestonesInput" class="small-textarea" disabled></textarea>
          </div>
          <div class="bottom-pane">
            <h2>Yearly Action Plans</h2>
            <textarea id="achievementYearlyActionPlansInput" class="small-textarea" disabled></textarea>
          </div>
        </div>      
      </div>
      <div class="right-pane">
        <h2>Achievements & Reflection</h2>
        <textarea id="achievementInput" class="large-textarea" oninput="saveGoal('achievementInput', selectedDate);"></textarea>
      </div>
    </div>
  </div>

  <div class="tabcontent" id="question">
    <h2>Question</h2>
    <button onclick="generateRandomQuestion()">Generate Question</button>
    <p id="questionDisplay"></p>
    <textarea class="small-textarea"></textarea>
  </div>

  <div class="tabcontent" id="about">
    <h2>About</h2>
    <p>Welcome to our text-based scheduler, a tool designed to provide flexibility in planning your goals.</p>
    <p>Personally, I use it to update my daily goals every morning. These aren't just simple to-do lists, they're steps towards achieving higher, more substantial goals.</p>
    <p>Please note, each page is designed to reset at the start of its corresponding time period. For example, the daily goal page resets every day at 12am, while the weekly goal page resets every Monday.</p>
    <p>Feel free to use this tool however you like, and please let me know if you have any suggestions for improvement!</p>
  </div>

  <script src="https://www.gstatic.com/firebasejs/8.2.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.2.1/firebase-firestore.js"></script>

  <script>
    
    let selectedDate = new Date(); // Default to today's date

    function updateSelectedDate() {
      const datePicker = document.getElementById("datePicker");
      selectedDate = new Date(datePicker.value + "T12:00:00");
      loadSelectedDateData();
    }

    function loadSelectedDateData() {
      const year = selectedDate.getFullYear();
      const month = String(selectedDate.getMonth() + 1).padStart(2, '0');
      const day = String(selectedDate.getDate()).padStart(2, '0');

      // Load all goals and data based on the selected date
      loadGoal('visionInput', 'day-' + year + '-' + month + '-' + day);
      loadGoal('yearlyImprovement', 'day-' + year + '-' + month + '-' + day);
      loadGoal('yearlyPerfectYear', 'day-' + year + '-' + month + '-' + day);
      loadGoal('yearlyStartDoing', 'day-' + year + '-' + month + '-' + day);
      loadGoal('yearlyStopDoing', 'day-' + year + '-' + month + '-' + day);
      // loadGoal('yearlyGoalInput', 'day-' + year + '-' + month + '-' + day);
      loadGoal('yearlyMilestonesInput', 'day-' + year + '-' + month + '-' + day);
      loadGoal('yearlyActionPlansInput', 'day-' + year + '-' + month + '-' + day);
      // loadGoal('monthlyYearlyGoalInput', 'day-' + year + '-' + month + '-' + day);

      loadGoal('monthlyMilestonesInput',  'day-' + year + '-' + month + '-' + day);
      loadGoal('monthlyActionPlansInput',  'day-' + year + '-' + month + '-' + day);

      loadGoal('weeklyMilestonesInput',  'day-' + year + '-' + month + '-' + day);
      loadGoal('weeklyActionPlansInput',  'day-' + year + '-' + month + '-' + day);

      loadGoal('dailyMilestonesInput',  'day-' + year + '-' + month + '-' + day);
      loadGoal('dailyActionPlansInput',  'day-' + year + '-' + month + '-' + day);

      loadGoal('achievementInput', 'day-' + year + '-' + month + '-' + day);
      loadGoal('achievementYearlyMilestonesInput', 'day-' + year + '-' + month + '-' + day);
      loadGoal('achievementYearlyActionPlansInput', 'day-' + year + '-' + month + '-' + day);
      // loadGoal('achievementYearlyGoalInput', 'day-' + year + '-' + month + '-' + day);
    }

    const firebaseConfig = {
      apiKey: "AIzaSyDGGHtfrqX6fEDFPZnvhWO1NQFNjL0P0Y8",
      authDomain: "pathfinder-fd96a.firebaseapp.com",
      projectId: "pathfinder-fd96a",
      storageBucket: "pathfinder-fd96a.appspot.com",
      messagingSenderId: "801645100816",
      appId: "1:801645100816:web:e9118c18d09a3fc79b2f95",
      measurementId: "G-DPJQ376Q6J"
    }; 

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const queryString = window.location.search;
    const urlParams = new URLSearchParams(queryString);
    const username = urlParams.get('username');

    // Hide other tabs and load saved goals
    const tabContents = document.querySelectorAll('.tabcontent');

    tabContents.forEach(content => {
      if (content.id !== 'dailyGoal') {
        content.style.display = 'none';
      }
    });
  
    window.addEventListener('DOMContentLoaded', () => {
      const today = new Date();
      const year = today.getFullYear();
      const month = String(today.getMonth() + 1).padStart(2, '0');
      const day = String(today.getDate()).padStart(2, '0');

      // Load the default data based on today's date
      loadGoal('visionInput', 'day-' + year + '-' + month + '-' + day);
      // loadGoal('yearlyGoalInput', 'day-' + year + '-' + month + '-' + day);

      loadGoal('yearlyMilestonesInput', 'day-' + year + '-' + month + '-' + day);
      loadGoal('yearlyImprovement', 'day-' + year + '-' + month + '-' + day);
      loadGoal('yearlyPerfectYear', 'day-' + year + '-' + month + '-' + day);
      loadGoal('yearlyStartDoing', 'day-' + year + '-' + month + '-' + day);
      loadGoal('yearlyStopDoing', 'day-' + year + '-' + month + '-' + day);
      loadGoal('yearlyActionPlansInput', 'day-' + year + '-' + month + '-' + day);
      // loadGoal('monthlyYearlyGoalInput', 'day-' + year + '-' + month + '-' + day);

      loadGoal('monthlyMilestonesInput',  'day-' + year + '-' + month + '-' + day);
      loadGoal('monthlyActionPlansInput',  'day-' + year + '-' + month + '-' + day);

      loadGoal('weeklyMilestonesInput',  'day-' + year + '-' + month + '-' + day);
      loadGoal('weeklyActionPlansInput',  'day-' + year + '-' + month + '-' + day);

      loadGoal('dailyMilestonesInput',  'day-' + year + '-' + month + '-' + day);
      loadGoal('dailyActionPlansInput',  'day-' + year + '-' + month + '-' + day);

      loadGoal('achievementInput', 'day-' + year + '-' + month + '-' + day);
      loadGoal('achievementYearlyMilestonesInput', 'day-' + year + '-' + month + '-' + day);
      loadGoal('achievementYearlyActionPlansInput', 'day-' + year + '-' + month + '-' + day);

      updateAchievement();
    });

    function saveGoal(inputId, selectedDateStr) {
      const input = document.getElementById(inputId);
      
      const selectedDate = new Date(selectedDateStr);

      // Get the year, month, and day from the selected date
      const year = selectedDate.getFullYear();
      const month = String(selectedDate.getMonth() + 1).padStart(2, '0');
      const day = String(selectedDate.getDate()).padStart(2, '0');
      const week = getWeekNumber(selectedDate);
      
      let documentName;

      // Determine the document name based on the inputId and selected date
      if (inputId === 'yearlyMilestonesInput') {
        documentName = 'year-' + year + '-milestones';  
      } else if (inputId === 'yearlyActionPlansInput') {
        documentName = 'year-' + year + '-actionplans'; 
      } else if (inputId === 'yearlyImprovement') {
        documentName = 'year-' + year + '-improvement';
      } else if (inputId === 'yearlyPerfectYear') {
        documentName = 'year-' + year + '-perfectyear';
      } else if (inputId === 'yearlyStartDoing') {
        documentName = 'year-' + year + '-startdoing';
      } else if (inputId === 'yearlyStopDoing') {
        documentName = 'year-' + year + '-stopdoing';
      } else if (inputId === 'achievementInput') {
        documentName = 'year-' + year + '-achievement';
      } else if (inputId === 'monthlyMilestonesInput') {
        documentName = 'month-' + year + '-' + month + '-milestones';
      } else if (inputId === 'monthlyActionPlansInput') {
        documentName = 'month-' + year + '-' + month + '-actionplans';
      } else if (inputId === 'weeklyMilestonesInput') {
        documentName = 'week-' + year + '-W' + week + '-milestones';
      } else if (inputId === 'weeklyActionPlansInput') {
        documentName = 'week-' + year + '-W' + week + '-actionplans';
      } else if (inputId === 'dailyMilestonesInput') {
        documentName = 'day-' + year + '-' + month + '-' + day + '-milestones';
      } else if (inputId === 'dailyActionPlansInput') {
        documentName = 'day-' + year + '-' + month + '-' + day + '-actionplans';
      } else {
        documentName = inputId; // Default to the inputId for other inputs
      }

      // Save the goal to Firebase Firestore
      db.collection("users").doc(username).collection("goals").doc(documentName).set({
        value: input.value
      })
      .then(() => {
        console.log("Goal saved to Firestore");
      })
      .catch((error) => {
        console.error("Error saving goal to Firestore: ", error);
      });
    }

    // Load the goal from Firebase Firestore using the updated document name
    function loadGoal(inputId, selectedDateStr) {
      
      console.log(selectedDateStr)

      const input = document.getElementById(inputId);

      const selectedDate = new Date(selectedDateStr);

      // Get the year, month, and day from the selected date
      const year = selectedDate.getFullYear();
      const month = String(selectedDate.getMonth() + 1).padStart(2, '0');
      const day = String(selectedDate.getDate()).padStart(2, '0');
      const week = getWeekNumber(selectedDate);

      let documentName;

      // Determine the document name based on the inputId and selected date
      if (inputId === 'yearlyMilestonesInput') {
        documentName = 'year-' + year + '-milestones';  
      } else if (inputId === 'yearlyActionPlansInput') {
        documentName = 'year-' + year + '-actionplans'; 
      } else if (inputId === 'yearlyImprovement') {
        documentName = 'year-' + year + '-improvement';
      } else if (inputId === 'yearlyPerfectYear') {
        documentName = 'year-' + year + '-perfectyear';
      } else if (inputId === 'yearlyStartDoing') {
        documentName = 'year-' + year + '-startdoing';
      } else if (inputId === 'yearlyStopDoing') {
        documentName = 'year-' + year + '-stopdoing';
      } else if (inputId === 'achievementInput') {
        documentName = 'year-' + year + '-achievement';
      } else if (inputId === 'monthlyMilestonesInput') {
        documentName = 'month-' + year + '-' + month + '-milestones';
      } else if (inputId === 'monthlyActionPlansInput') {
        documentName = 'month-' + year + '-' + month + '-actionplans';
      } else if (inputId === 'weeklyMilestonesInput') {
        documentName = 'week-' + year + '-W' + week + '-milestones';
      } else if (inputId === 'weeklyActionPlansInput') {
        documentName = 'week-' + year + '-W' + week + '-actionplans';
      } else if (inputId === 'dailyMilestonesInput') {
        documentName = 'day-' + year + '-' + month + '-' + day + '-milestones';
      } else if (inputId === 'dailyActionPlansInput') {
        documentName = 'day-' + year + '-' + month + '-' + day + '-actionplans';
      } else {
        documentName = inputId; // Default to the inputId for other inputs
      }

      // Load the goal from Firebase Firestore
      db.collection("users").doc(username).collection("goals").doc(documentName).get()
      .then((doc) => {
        if (doc.exists) {
          const goal = doc.data().value;
          input.value = goal;
        } else{

          if (inputId === 'monthlyActionPlansInput'){
            let fill_week_text = '';
            for (let i = 1; i <= 4; i++) {
              let week_text = `[Week ${i}] \n`;
              fill_week_text += week_text;
            }
            input.value = fill_week_text;
          } else if (inputId === 'weeklyActionPlansInput'){
            let fill_day_text = '';
            const days = ['[Monday]', '[Tuesday]', '[Wednesday]', '[Thursday]', '[Friday]', '[Saturday]', '[Sunday]'];
            for (let j = 1; j <= 7; j++) {
              let day_text = `[${days[j-1]}] \n`;
              fill_day_text += day_text;
            }
            input.value = fill_day_text;
          } else {
            input.value = "";
          }

        }
      })
      .catch((error) => {
        console.error("Error loading goal from Firestore: ", error);
      });
    }

    // Get the week number
    function getWeekNumber(d) {
      d = new Date(Date.UTC(d.getFullYear(), d.getMonth(), d.getDate()));
      d.setUTCDate(d.getUTCDate() + 4 - (d.getUTCDay() || 7));
      let yearStart = new Date(Date.UTC(d.getUTCFullYear(), 0, 1));
      let weekNo = Math.ceil((((d - yearStart) / 86400000) + 1) / 7);
      return weekNo;
    }

    function openTab(evt, tabName, selectedDate) {
        // Hide all tab contents
        tabContents.forEach(content => {
          content.style.display = 'none';
        });

        // Show the selected tab content
        const selectedTabContent = document.getElementById(tabName);
        if (selectedTabContent) {
          selectedTabContent.style.display = 'block';

          const paneInputIds = {
            achievement: ['achievementYearlyMilestonesInput', 'achievementYearlyActionPlansInput']
          };

          const previousGoalInputIds = {
            achievement: ['yearlyMilestonesInput', 'yearlyActionPlansInput']
          };

          const leftPaneInputIds = paneInputIds[tabName];
          const prevGoalInputIds = previousGoalInputIds[tabName];

          if (leftPaneInputIds && prevGoalInputIds) {
            for (let i = 0; i < leftPaneInputIds.length; i++) {
              const leftPaneInput = document.getElementById(leftPaneInputIds[i]);
              const previousGoalInput = document.getElementById(prevGoalInputIds[i]);
              if (leftPaneInput && previousGoalInput) {
                leftPaneInput.value = previousGoalInput.value;
              }
            }
          }
        }
      }    


    function updateAchievement() {
      const yearlyMilestonesInput = document.getElementById('yearlyMilestonesInput');
      const yearlyActionPlansInput = document.getElementById('yearlyActionPlansInput');

      const achievementYearlyMilestonesInput = document.getElementById('achievementYearlyMilestonesInput');
      const achievementYearlyActionPlansInput = document.getElementById('achievementYearlyActionPlansInput');

      achievementYearlyMilestonesInput.value = yearlyMilestonesInput.value;
      achievementYearlyActionPlansInput.value = yearlyActionPlansInput.value;
    }

    function generateRandomQuestion() {
      const questionDisplay = document.getElementById('questionDisplay');
      const randomIndex = Math.floor(Math.random() * questions.length);
      const randomQuestion = questions[randomIndex];
      questionDisplay.innerHTML = randomQuestion;
    }    

  </script>
</body>
</html>