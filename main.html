<!DOCTYPE html>
<html>
<head>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f5f5f5;
      text-align: center;
      color: #333;
    }
    
    .tabcontent {
      margin: 10px auto; /* added top margin */
      padding: 20px;
      width: 90%;
      max-width: 800px;
      background-color: #ffffff;
      border-radius: 5px;
      box-shadow: 0px 5px 15px rgba(0, 0, 0, 0.1);
    }

    .large-tabcontent {
      width: 90%; /* adjust this value to your preference */
      margin: 10px auto; /* added top margin */
      max-width: 1800px;
    }

    .tabcontent h2, .tabcontent h3 {
      margin-bottom: 20px;
      color: #2c3e50;
    }

    #vision h3 {
      border-top: 1px dotted #333;
      padding-top: 20px;
    }

    .tabcontent label {
      display: block;
      margin-top: 20px;
      margin-bottom: 5px;
      font-weight: bold;
      color: #2c3e50;
    }

    /* .tabcontent textarea {
      width: 100%;
      height: 150px;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 5px;
      resize: vertical;
      font-size: 16px;
      box-sizing: border-box;
    } */

    .tabcontent .small-textarea {
      width: 100%;
      height: 250px;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 5px;
      resize: vertical;
      font-size: 16px;
      box-sizing: border-box;
    }

    .tabcontent .small-small-textarea {
      width: 100%;
      height: 150px;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 5px;
      resize: vertical;
      font-size: 16px;
      box-sizing: border-box;      
    }

    .tabcontent .large-textarea {
      width: 100%;
      height: 560px;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 5px;
      resize: vertical;
      font-size: 16px;
      box-sizing: border-box;
    }


    .tabcontent .large-large-textarea {
      width: 100%;
      height: 1000px;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 5px;
      resize: vertical;
      font-size: 16px;
      box-sizing: border-box;
    }

    /* .tabcontent textarea:focus {
      outline: none;
      border-color: #3498db;
      box-shadow: 0 0 5px rgba(52, 152, 219, 0.5);      
    } */

    .pane-container {
      display: flex;
      flex-direction: row;
      justify-content: space-between;
    }

    .pane-container .left-pane, .pane-container .right-pane {
      width: 49.5%;
    }    
    
    .vertical-pane-container {
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    .vertical-pane-container .top-pane,
    .vertical-pane-container .bottom-pane {
      width: 99%;
      flex: 1;
    }

    .date-selection {
      margin-top: 10px;
    }

    .date-selection label {
      margin-right: 10px;
    }    

    /* Horizontal split for Action Plans section */
    .action-plans-container {
      display: flex;
      gap: 20px;
    }

    .action-plans-container .action-plans {
      flex: 1;
    }

    .action-plans-container .progress {
      flex: 1;
    }  

    .spacer {
      display: block;
      height: 39px;  /* Adjust this value to create the space you need */
    }

    .ql-editor ul[data-checked="false"] > li::before {
      content: '\25A2';
      font-size: 1.5rem;
    }

    .ql-editor ul[data-checked="true"] li::before {
      content: '\2713';
      font-size: 1.5rem;
    }    

    .ql-editor ul li::before {
    content: '\2022'; /* Unicode for bullet point */
    font-size: 1.5rem; /* Size of the bullet point */
    vertical-align: middle; /* Align the bullet point in the middle vertically */
    }    

    .link-button {
        background-color: #b4b9ba; /* Blue */
        border: none;
        color: white;
        padding: 5px 5px;
        text-align: center;
        text-decoration: none;
        display: inline-block;
        font-size: 12px;
        /* margin: 4px 2px; */
        transition-duration: 0.4s;
        cursor: pointer;
        border-radius: 4px;
    }

    .link-button:hover {
        background-color: white;
        color: black;
    }

    .fullcalendar .highlighted {
    background-color: #FFD700 !important;
    }

    /* Add this to your CSS file or within a <style> tag in the head of your HTML document */
    .tab-container {
      margin: 40px; /* This adds a margin of 20px on all sides of the container. Adjust the value as needed. */
    }

    .tablink {
      margin-right: 10px; /* This adds a right margin to each button. Adjust as desired. */
      /* You can add more styles like padding, border, background-color, etc. for your buttons here if needed */
    }

    #calendar {
      margin-top: 30px;  /* Adjust this value according to how much lower you want the calendar to appear */
    }
  </style>

  <script src="questions_20230727.js"></script>
    
  <!-- Include stylesheet -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

  <script src="https://www.gstatic.com/firebasejs/8.2.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.2.1/firebase-firestore.js"></script>

  <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">

  <script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-colorpicker@3.4.0/dist/css/bootstrap-colorpicker.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap-colorpicker@3.4.0/dist/js/bootstrap-colorpicker.min.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>

  <script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.js'></script>


  
</head>

<body>
  <!-- <h1>Find Your Path</h1> -->

  <!-- Tabs -->
  <div class="tab-container">

    <div id="tabs">
      <button class="tablink" onclick="openTab(event, 'vision')">Vision</button>
      <button class="tablink" onclick="openTab(event, 'yearlyGoal')">Yearly Goal</button>
      <button class="tablink" onclick="openTab(event, 'monthlyGoal')">Monthly Goal</button>
      <button class="tablink" onclick="openTab(event, 'weeklyGoal')">Weekly Goal</button>
      <button class="tablink" onclick="openTab(event, 'dailyGoal')">Daily To Do</button>
      <button class="tablink" onclick="openTab(event, 'achievement')">Achievements & Reflection</button>
      <button class="tablink" onclick="openTab(event, 'question')">Question</button>
      <button class="tablink" onclick="openTab(event, 'about')">About</button>
    </div>
  </div>

  <!-- Date selection -->
  <div class="date-selection">
    <input type="date" id="datePicker" onchange="updateSelectedDate()">
  </div>
  <!-- Content -->

  <div class="tabcontent" id="vision">
    <h2>Vision</h2>
    <div id="visionInput" class="large-textarea"></div>

  </div>

  <div class="tabcontent" id="yearlyGoal">
    <h2>My Goals</h2>
    <div id="yearlyMilestonesInput" class="small-textarea"></div>

    <h2>What are the key actions?</h2>
    <div id="yearlyActionPlansInput" class="large-textarea"></div>

    <h2>Your Focus</h2>
    <label for="yearlyImprovement">How will you improve yourself?</label>
    <div id="yearlyImprovement" class="small-textarea"></div>
  
    <label for="yearlyPerfectYear">What would the ideal year look like?</label>
    <div id="yearlyPerfectYear" class="small-textarea"></div>
  
    <label for="yearlyStartDoing">What do you want to initiate?</label>
    <div id="yearlyStartDoing" class="small-textarea"></div>
  
    <label for="yearlyStopDoing">What would you like to stop doing?</label>
    <div id="yearlyStopDoing" class="small-textarea"></div>
      
  </div>

  <div class="tabcontent" id="monthlyGoal">
    <div class="monthlyGoal">
      <h2>Monthly Milestones</h2>
      <label for="monthlyMilestonesInput">What do you want to accomplish this month, and how does it contributes to your higher goal?</label>
      <div id="monthlyMilestonesInput" class="large-textarea"></div>

        <!-- <div class="pane-container">
            <div class="left-pane">
                <h2>Monthly Milestones</h2>
                <label for="monthlyMilestonesInput">What do you want to accomplish this month, and how does it contributes to your higher goal?</label>
                <div id="monthlyMilestonesInput" class="large-textarea"></div>
            </div>
            <div class="right-pane">
                <h2>Monthly Action Plans</h2>
                <label for="monthlyMilestonesInput">What are the key actions to achieve those goals?</label>
                <div id="monthlyActionPlansInput" class="large-textarea"></div>
            </div>
        </div> -->
    </div>
  </div>

  <div class="tabcontent large-tabcontent" id="weeklyGoal">
      <!-- <div class="weeklyGoal">     
          <div class="pane-container">
              <div class="left-pane">
                  <h2>Weekly Goals</h2>
                  <label for="weeklyMilestonesInput">What is your focus this week?</label>
                  <div id="weeklyMilestonesInput" class="large-textarea"></div>
              </div>
              <div class="right-pane">
                  <h2>Action Plans</h2>
                  <label for="weeklyActionPlansInput">What are the key actions?</label>
                  <div id="weeklyActionPlansInput" class="large-textarea"></div>
            </div>
          </div> 
      </div> -->
      <div class="pane-container">
        <div class="left-pane">

          <div id='calendar'></div>

        </div>
        <div class="right-pane">
          <h2>Weekly Goals</h2>
          <label for="weeklyMilestonesInput">What is your focus this week?</label>
          <div id="weeklyMilestonesInput" class="large-textarea"></div>
      </div>
      </div>
  </div>
  
  <div class="tabcontent" id="dailyGoal">
      <div class="dailyGoal">
        <h2>Daily Goal</h2>
        <label for="dailyMilestonesInput">What is your focus today?</label>
        <div id="dailyMilestonesInput" class="large-textarea"></div>
          <!-- <div class="vertical-pane-container">
            <div class="top-pane">
              <h2>Daily Goal</h2>
              <label for="dailyMilestonesInput">What is your focus today?</label>
              <div id="dailyMilestonesInput" class="large-large-textarea"></div>
            </div>
            <div class="bottom-pane">
              <h2>Tasks</h2>
              <label for="dailyActionPlansInput">What are the important tasks?</label>
              <div id="dailyActionPlansInput" class="large-large-textarea"></div>
            </div>
            <div class="bottom-pane">
              <label for="dailyProgressInput">Challenges and Reflection</label>
              <div id="dailyProgressInput" class="small-textarea"></div>
            </div>            
          </div>     -->
      </div>      
  </div>
  
  <div class="tabcontent large-tabcontent" id="achievement">
    <div class="pane-container">
      <div class="left-pane">
        <div class="top-pane">
          <h2>Yearly Milestones</h2>
          <div id="achievementYearlyMilestonesInput" class="large-textarea" disabled></div>
        </div>        
        <!-- <div class="vertical-pane-container">
          <div class="top-pane">
            <h2>Yearly Milestones</h2>
            <div id="achievementYearlyMilestonesInput" class="small-textarea" disabled></div>
          </div>
          <div class="bottom-pane">
            <h2>Yearly Action Plans</h2>
            <div id="achievementYearlyActionPlansInput" class="small-textarea" disabled></div>
          </div>
        </div>       -->
      </div>
      <div class="right-pane">
        <h2>Achievements & Reflection</h2>
        <div id="achievementInput" class="large-textarea"></div>
      </div>
    </div>
  </div>

  <div class="tabcontent" id="question">
    <button onclick="generateRandomQuestion()">Generate Question</button>
    <p id="questionDisplay"></p>
    <div id="questionInput" class="small-textarea"></div>

    <div id="answeredQuestionsContainer">
      <h2>Answered Questions</h2>
      <div id="answeredQuestions"></div>    
    </div>
  </div>

  <div class="tabcontent" id="about">
    <h2>About</h2>
    <p>Welcome to our text-based scheduler, a tool designed to provide flexibility in planning your goals.</p>

    <p>Personally, I use it to update my daily goals every morning. These aren't just simple to-do lists, they're steps towards achieving higher, more substantial goals.</p>
    <p>Please note, each page is designed to reset at the start of its corresponding time period. For example, the daily goal page resets every day at 12am, while the weekly goal page resets every Monday.</p>
    <p>This tool is equipped with a text editor which has the following keyboard shortcuts to facilitate your text input:</p>
    <ul>
      <li><kbd>Ctrl+B</kbd> or <kbd>Cmd+B</kbd>: Make text bold.</li>
      <li><kbd>Ctrl+I</kbd> or <kbd>Cmd+I</kbd>: Make text italic.</li>
      <li><kbd>Ctrl+U</kbd> or <kbd>Cmd+U</kbd>: Underline text.</li>
      <li><kbd>Ctrl+Z</kbd> or <kbd>Cmd+Z</kbd>: Undo the last action.</li>
      <li><kbd>Ctrl+K</kbd> or <kbd>Cmd+K</kbd>: Insert a hyperlink.</li>
      <li><kbd>-</kbd>: Create a bullet point.</li>
      <li><kbd>[]</kbd>: Create a checkbox.</li>
    </ul>
    <p>Your privacy is important to us. All your personal information and goals are encrypted and stored securely. They are only visible to you and cannot be accessed by others. We respect and protect your privacy.</p>
    <p>Feel free to use this tool however you like, and please let me know if you have any suggestions for improvement! <a href="mailto:quantic.jh@gmail.com">Email To: Jongho Kim</a></p>
  </div>
  
  <script>    
    var secretKey = "pathfinder"; // replace with your own secret key

    function encryptText(plainText) {
        return CryptoJS.AES.encrypt(plainText, secretKey).toString();
    }

    function decryptText(cipherText) {
      try {
          var bytes = CryptoJS.AES.decrypt(cipherText, secretKey);
          var decryptedText = bytes.toString(CryptoJS.enc.Utf8);

          return decryptedText;

      } catch (error) {
          // If there's an error in decryption, we assume the text was not encrypted
          return cipherText;
      }
    }

    // Get the default List
    const List = Quill.import("formats/list");

    class BetterList extends List {
      constructor(el) {
        super(el);

        const isCheckList = el.hasAttribute("data-checked");
        el.addEventListener("touchstart", (e) => {
          if (!isCheckList) {
            return;
          }
          e.preventDefault();
        });
      }
    }

    // Register the BetterList
    Quill.register("formats/list", BetterList);

    var quillInstances = {};

    // Assuming ids is an array of your div ids
    var ids = ['visionInput'
              ,'yearlyMilestonesInput'
              ,'yearlyActionPlansInput'
              ,'yearlyImprovement'
              ,'yearlyPerfectYear'
              ,'yearlyStartDoing'
              ,'yearlyStopDoing'
              ,'monthlyMilestonesInput'
              // ,'monthlyActionPlansInput'
              ,'weeklyMilestonesInput'
              // ,'weeklyActionPlansInput'
              ,'dailyMilestonesInput'
              // ,'dailyActionPlansInput'
              // ,'dailyProgressInput'
              ,'achievementYearlyMilestonesInput'
              // ,'achievementYearlyActionPlansInput'
              ,'achievementInput'
              ,'questionInput']; 

    ids.forEach(function(id) {
        // Create a new Quill instance for each id
        if (id == 'achievementYearlyMilestonesInput' || id == 'achievementYearlyActionPlansInput'){
          var quill = new Quill('#' + id, {
              theme: 'bubble',
              modules: {
                  toolbar: false,  // Hide the toolbar
                },
              readOnly: true 
          });
        } else{
          var quill = new Quill('#' + id, {
          modules: {     
            clipboard: {
              matchVisual: false
            },                   
            toolbar: [
                      ['bold', 'italic', 'underline', 'strike'],
                      [{ 'list': 'check' }],    // List buttons  { 'list': 'ordered' }, { 'list': 'bullet' }, 
                      [{ 'indent': '-1' }, { 'indent': '+1' }],         // Indentation buttons
                      [{ 'header': [1, 2, 3, 4, 5, 6, false] }],         // Header dropdown
                      ['link', 'image'],                                 // Additional buttons
                      [{ 'color': ['#FFFFFF', '#979A9B', '#937264', '#FFA344',
                                   '#FFDC49', '#4DAB9A', '#529CCA', '#9A6DD7',
                                   '#E255A1', '#FF7369'] }],                                // Color button
                      ['clean']                                         // Remove formatting button        
                    ],
          },
          formats : [
            "background",
            "bold", 
            "color", 
            "font", 
            "code", 
            "italic", 
            "link", 
            "size", 
            "strike", 
            "script",
            "underline", 
            "blockquote", 
            // "header",
            "indent", 
            "list", // <-- commented-out to suppress auto bullets
            "align", 
            "direction", 
            "code-block", 
            "formula", 
            "image",
            "video"
          ],
          theme: 'snow',
          // readOnly: true 
        });
        }

        quill.on('text-change', function() {
              saveGoal(id, selectedDate);
        });          

        quill.root.spellcheck = false;
        quill.root.focus();
        quill.root.blur();

        // Store the qu instance in the quillInstances dictionary
        quillInstances[id] = quill;
    });
    
    function saveGoal(inputId, selectedDateStr) {
      const selectedDate = new Date(selectedDateStr);

      // Get the year, month, and day from the selected date
      const year = selectedDate.getFullYear();
      const month = String(selectedDate.getMonth() + 1).padStart(2, '0');
      const day = String(selectedDate.getDate()).padStart(2, '0');
      const week = getWeekNumber(selectedDate);
      
      let documentName;    

      // Determine the document name based on the inputId and selected date
      if (inputId === 'yearlyMilestonesInput') {
        documentName = 'year-' + year + '-milestones';  
      } else if (inputId === 'yearlyActionPlansInput') {
        documentName = 'year-' + year + '-actionplans'; 
      } else if (inputId === 'yearlyImprovement') {
        documentName = 'year-' + year + '-improvement';
      } else if (inputId === 'yearlyPerfectYear') {
        documentName = 'year-' + year + '-perfectyear';
      } else if (inputId === 'yearlyStartDoing') {
        documentName = 'year-' + year + '-startdoing';
      } else if (inputId === 'yearlyStopDoing') {
        documentName = 'year-' + year + '-stopdoing';
      } else if (inputId === 'achievementInput') {
        documentName = 'year-' + year + '-achievement';
      } else if (inputId === 'monthlyMilestonesInput') {
        documentName = 'month-' + year + '-' + month + '-milestones';
      } else if (inputId === 'monthlyActionPlansInput') {
        documentName = 'month-' + year + '-' + month + '-actionplans';
      } else if (inputId === 'weeklyMilestonesInput') {
        documentName = 'week-' + year + '-W' + week + '-milestones';
      } else if (inputId === 'weeklyActionPlansInput') {
        documentName = 'week-' + year + '-W' + week + '-actionplans';
      } else if (inputId === 'dailyMilestonesInput') {
        documentName = 'day-' + year + '-' + month + '-' + day + '-milestones';
      } else if (inputId === 'dailyActionPlansInput') {
        documentName = 'day-' + year + '-' + month + '-' + day + '-actionplans';
      } else if (inputId === 'dailyProgressInput') {
        documentName = 'day-' + year + '-' + month + '-' + day + '-progress';
      } else if(inputId === 'questionInput') {
        documentName = 'question-' + question_number;
        fetchAndDisplayAnsweredQuestions();
      } else {
        documentName = inputId; // Default to the inputId for other inputs
      }

      // Get the Quill instance for this inputId
      const quill = quillInstances[inputId];

      // Get the value from the Quill editor
      const value = quill.getText().trim() === '' ? '' : quill.root.innerHTML;

      const encryptedValue = encryptText(value);
      
      // Save the goal to Firebase Firestore
      db.collection("users").doc(username).collection("goals").doc(documentName).set({
        value: encryptedValue
      })
      .then(() => {
        console.log("Goal saved to Firestore");
      })
      .catch((error) => {
        console.error("Error saving goal to Firestore: ", error);
      });
    }

    function loadGoal(inputId, selectedDateStr) {

      const selectedDate = new Date(selectedDateStr);

      // Get the year, month, and day from the selected date
      const year = selectedDate.getFullYear();
      const month = String(selectedDate.getMonth() + 1).padStart(2, '0');
      const day = String(selectedDate.getDate()).padStart(2, '0');
      const week = getWeekNumber(selectedDate);

      let documentName;

      // Determine the document name based on the inputId and selected date
      if (inputId === 'yearlyMilestonesInput') {
        documentName = 'year-' + year + '-milestones';  
      } else if (inputId === 'yearlyActionPlansInput') {
        documentName = 'year-' + year + '-actionplans'; 
      } else if (inputId === 'yearlyImprovement') {
        documentName = 'year-' + year + '-improvement';
      } else if (inputId === 'yearlyPerfectYear') {
        documentName = 'year-' + year + '-perfectyear';
      } else if (inputId === 'yearlyStartDoing') {
        documentName = 'year-' + year + '-startdoing';
      } else if (inputId === 'yearlyStopDoing') {
        documentName = 'year-' + year + '-stopdoing';
      } else if (inputId === 'achievementInput') {
        documentName = 'year-' + year + '-achievement';
      } else if (inputId === 'monthlyMilestonesInput') {
        documentName = 'month-' + year + '-' + month + '-milestones';
      } else if (inputId === 'monthlyActionPlansInput') {
        documentName = 'month-' + year + '-' + month + '-actionplans';
      } else if (inputId === 'weeklyMilestonesInput') {
        documentName = 'week-' + year + '-W' + week + '-milestones';
      } else if (inputId === 'weeklyActionPlansInput') {
        documentName = 'week-' + year + '-W' + week + '-actionplans';
      } else if (inputId === 'dailyMilestonesInput') {
        documentName = 'day-' + year + '-' + month + '-' + day + '-milestones';
      } else if (inputId === 'dailyActionPlansInput') {
        documentName = 'day-' + year + '-' + month + '-' + day + '-actionplans';
      } else if (inputId === 'dailyProgressInput') {
        documentName = 'day-' + year + '-' + month + '-' + day + '-progress';
      } else if(inputId === 'questionInput') {
        documentName = 'question-' + question_number;
      } else {
        documentName = inputId; // Default to the inputId for other inputs
      }

      db.collection("users").doc(username).collection("goals").doc(documentName).get()
      .then((doc) => {
        if (doc.exists) {
          let encryptedGoal = doc.data().value;

          let goal = decryptText(encryptedGoal);
          // Get the Quill instance for this inputId
          var quill = quillInstances[inputId];

          if (inputId === 'achievementYearlyMilestonesInput' || inputId === 'achievementYearlyActionPlansInput'){
            quill.disable();
            quill.clipboard.dangerouslyPasteHTML(goal);
          } else{
            quill.disable();
            quill.clipboard.dangerouslyPasteHTML(goal);
            quill.enable();
          }

        } else {
          // if (inputId === 'monthlyActionPlansInput'){
          //   let fill_week_text = '';
          //   for (let i = 1; i <= 4; i++) {
          //     let week_text = `<p>[Week ${i}]<\p><br>`;
          //     fill_week_text += week_text;
          //   }
          //   // Set the content in the Quill.js editor
          //   var quill = quillInstances[inputId];
          //   quill.disable();
          //   quill.clipboard.dangerouslyPasteHTML(fill_week_text);            
          //   quill.enable();

          // } else if (inputId === 'weeklyActionPlansInput'){
          //   let fill_day_text = '';
          //   const days = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday'];
          //   for (let j = 1; j <= 7; j++) {
          //     let day_text = `<p>[${days[j-1]}]<\p><br>`;
          //     fill_day_text += day_text;
          //   }
          //   // Set the content in the Quill.js editor
          //   var quill = quillInstances[inputId];
          //   quill.disable();
          //   quill.clipboard.dangerouslyPasteHTML(fill_day_text); 
          //   quill.enable();

          // } else {
          //   // For other inputs, we leave the editor empty
          //   var quill = quillInstances[inputId];
          //   quill.disable();
          //   quill.clipboard.dangerouslyPasteHTML(''); 
          //   quill.enable();
          // }
          var quill = quillInstances[inputId];
          quill.disable();
          quill.clipboard.dangerouslyPasteHTML(''); 
          quill.enable();          
        }
      })
      .catch((error) => {
        console.error("Error loading goal from Firestore: ", error);
      });
    }

    function loadSelectedDateData() {
      const year = selectedDate.getFullYear();
      const month = String(selectedDate.getMonth() + 1).padStart(2, '0');
      const day = String(selectedDate.getDate()).padStart(2, '0');

      // Load all goals and data based on the selected date
      loadGoal('visionInput', 'day-' + year + '-' + month + '-' + day);
      loadGoal('yearlyImprovement', 'day-' + year + '-' + month + '-' + day);
      loadGoal('yearlyPerfectYear', 'day-' + year + '-' + month + '-' + day);
      loadGoal('yearlyStartDoing', 'day-' + year + '-' + month + '-' + day);
      loadGoal('yearlyStopDoing', 'day-' + year + '-' + month + '-' + day);
      // loadGoal('yearlyGoalInput', 'day-' + year + '-' + month + '-' + day);
      loadGoal('yearlyMilestonesInput', 'day-' + year + '-' + month + '-' + day);
      loadGoal('yearlyActionPlansInput', 'day-' + year + '-' + month + '-' + day);
      // loadGoal('monthlyYearlyGoalInput', 'day-' + year + '-' + month + '-' + day);

      loadGoal('monthlyMilestonesInput',  'day-' + year + '-' + month + '-' + day);
      // loadGoal('monthlyActionPlansInput',  'day-' + year + '-' + month + '-' + day);

      loadGoal('weeklyMilestonesInput',  'day-' + year + '-' + month + '-' + day);
      // loadGoal('weeklyActionPlansInput',  'day-' + year + '-' + month + '-' + day);

      loadGoal('dailyMilestonesInput',  'day-' + year + '-' + month + '-' + day);
      // loadGoal('dailyActionPlansInput',  'day-' + year + '-' + month + '-' + day);
      // loadGoal('dailyProgressInput',  'day-' + year + '-' + month + '-' + day);

      loadGoal('achievementInput', 'day-' + year + '-' + month + '-' + day);
      loadGoal('achievementYearlyMilestonesInput', 'day-' + year + '-' + month + '-' + day);
      loadGoal('achievementYearlyActionPlansInput', 'day-' + year + '-' + month + '-' + day);
      fetchAndDisplayAnsweredQuestions();
    };

    function updateSelectedDate() {
      const datePicker = document.getElementById("datePicker");
      selectedDate = new Date(datePicker.value + "T12:00:00");
      loadSelectedDateData();
    };
    
    let selectedDate = new Date(); // Default to today's date

    const firebaseConfig = {
      apiKey: "AIzaSyDGGHtfrqX6fEDFPZnvhWO1NQFNjL0P0Y8",
      authDomain: "pathfinder-fd96a.firebaseapp.com",
      projectId: "pathfinder-fd96a",
      storageBucket: "pathfinder-fd96a.appspot.com",
      messagingSenderId: "801645100816",
      appId: "1:801645100816:web:e9118c18d09a3fc79b2f95",
      measurementId: "G-DPJQ376Q6J"
    }; 

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const queryString = window.location.search;
    const urlParams = new URLSearchParams(queryString);

    const encryptedUsername = decodeURIComponent(urlParams.get('username'));
    const decrypt_username = decryptText(encryptedUsername);
    const username = decrypt_username;

    loadSelectedDateData();

    // ids.forEach(function(id) {
    //     // Create a new Quill instance for each id
    //     if (id != 'achievementYearlyMilestonesInput' || id != 'achievementYearlyActionPlansInput'){

    //       var quill = quillInstances[id];
    //       quill.enable();
    //     }
    // });

    // Hide other tabs and load saved goals
    const tabContents = document.querySelectorAll('.tabcontent');

    tabContents.forEach(content => {
      if (content.id !== 'weeklyGoal') {
        content.style.display = 'none';
      }
    });
  
    // Get the week number
    function getWeekNumber(d) {
      d = new Date(Date.UTC(d.getFullYear(), d.getMonth(), d.getDate()));
      d.setUTCDate(d.getUTCDate() + 4 - (d.getUTCDay() || 7));
      let yearStart = new Date(Date.UTC(d.getUTCFullYear(), 0, 1));
      let weekNo = Math.ceil((((d - yearStart) / 86400000) + 1) / 7);
      return weekNo;
    }

    function openTab(evt, tabName, selectedDate) {
        // Hide all tab contents
        tabContents.forEach(content => {
          content.style.display = 'none';
        });

        // Show the selected tab content
        const selectedTabContent = document.getElementById(tabName);
        if (selectedTabContent) {
          selectedTabContent.style.display = 'block';

          const paneInputIds = {
            achievement: ['achievementYearlyMilestonesInput', 'achievementYearlyActionPlansInput']
          };

          const previousGoalInputIds = {
            achievement: ['yearlyMilestonesInput', 'yearlyActionPlansInput']
          };

          const leftPaneInputIds = paneInputIds[tabName];
          const prevGoalInputIds = previousGoalInputIds[tabName];

          if (leftPaneInputIds && prevGoalInputIds) {
            for (let i = 0; i < leftPaneInputIds.length; i++) {
              const leftPaneInputId = leftPaneInputIds[i];
              const previousGoalInputId = prevGoalInputIds[i];

              const leftPaneQuill = quillInstances[leftPaneInputId];
              const previousGoalQuill = quillInstances[previousGoalInputId];

              if (leftPaneQuill && previousGoalQuill) {
                const previousGoalContent = previousGoalQuill.getContents();
                leftPaneQuill.setContents(previousGoalContent);
              }
            }
          }          
        }
      }    

    let question_number = 'none';

    function generateRandomQuestion(questionIndex) {
      const questionDisplay = document.getElementById('questionDisplay');
      
      // If no question index is provided, choose a random index
      if(questionIndex === undefined) {
        questionIndex = Math.floor(Math.random() * questions.length);
      }
      
      const question = questions[questionIndex];
      questionDisplay.innerHTML = question;
      question_number = questionIndex;

      const year = selectedDate.getFullYear();
      const month = String(selectedDate.getMonth() + 1).padStart(2, '0');
      const day = String(selectedDate.getDate()).padStart(2, '0');

      loadGoal('questionInput', 'day-' + year + '-' + month + '-' + day);
    }

    function fetchAndDisplayAnsweredQuestions() {
        // Fetch all documents from Firestore
        db.collection("users").doc(username).collection("goals")
        .get()
        .then((querySnapshot) => {
            // Parse the document names and get the questions
            let answeredQuestions = [];
            querySnapshot.forEach((doc) => {
                let docName = doc.id;
                if(docName.startsWith('question-')) {
                    let questionIndex = parseInt(docName.split('-')[1]);
                    answeredQuestions.push(questionIndex);
                }
            });

            // Display the answered questions
            displayAnsweredQuestions(answeredQuestions);
        })
        .catch((error) => {
            console.log("Error getting documents: ", error);
        });
    }
    
    function removeQuestion(answeredQuestions, questionIndex) {
        // Assuming answeredQuestions is available globally

        console.log(answeredQuestions, typeof answeredQuestions);
        console.log(questionIndex);

        // Create the document name in the format 'question-{index}'
        let docName = `question-${questionIndex}`;
        
        console.log(docName);

        answeredQuestions.splice(questionIndex, 1); // Remove the question at the given index

        // Redisplay the list
        displayAnsweredQuestions(answeredQuestions);
        
        // Delete the document from Firestore
        db.collection("users").doc(username).collection("goals").doc(docName)
        .delete()
        .then(() => {
            console.log("Document successfully deleted!");
        })
        .catch((error) => {
            console.error("Error removing document: ", error);
        });  
    }

    function displayAnsweredQuestions(answeredQuestions) {

      const answeredQuestionsList = document.getElementById('answeredQuestions');
      answeredQuestionsList.innerHTML = ''; // Reset the list
      answeredQuestionsList.style.textAlign = 'left'; // Add left text alignment

      let question_counter = 1;

      answeredQuestions.forEach((questionIndex, index) => {
        let question = questions[questionIndex];

        if(question === undefined) {
          return;
        }

        let match = question.match(/<b>(.*?)<\/b>/);
        let boldText = match ? match[1] : question; // If no match, use the whole question

        let listItem = document.createElement('ul');

        listItem.innerHTML = `
            <b>${question_counter}. ${boldText}</b> 
            <button class="link-button" onclick="generateRandomQuestion(${questionIndex})">Visit</button>
            <button class="remove-button" onclick="removeQuestion(${answeredQuestions},${questionIndex})">Remove</button>
        `; // Display the text in bold, and add a "Visit" and "Remove" button

        answeredQuestionsList.appendChild(listItem);
        question_counter = question_counter+1;
      });

    }

    document.addEventListener('DOMContentLoaded', function() {
        var calendarEl = document.getElementById('calendar');
        var calendar = new FullCalendar.Calendar(calendarEl, {
        initialView: 'dayGridMonth',
        
        selectable: true,
        selectHelper: true,
        
        // Callback for date selection
        select: function(info) {
            let startDate = info.start;
            let endDate = info.end;
            
            // Loop through each day between start and end date
            while (startDate < endDate) {
                let dateStr = FullCalendar.formatDate(startDate, { month: 'numeric', day: 'numeric', year: 'numeric' });
                let cell = document.querySelector('.fc-day[data-date="' + dateStr + '"]');
                if (cell) {
                    cell.classList.add('highlighted');
                }
                startDate.setDate(startDate.getDate() + 1); // Move to next day
            }
        },
        
        // Deselect event to remove highlighting
        unselect: function() {
            let highlightedCells = document.querySelectorAll('.highlighted');
            highlightedCells.forEach(cell => {
                cell.classList.remove('highlighted');
            });
        },
        
        // This prevents a new selection from being immediately unselected
        unselectAuto: false
    });
    
        calendar.render();
      });
  </script>
</body>
</html>